<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>YOLOv3-for-custum-objects - Amine Hadj-Youcef</title>
<meta name="description" content="Train YOLO obect detector on custom dataset">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Amine Hadj-Youcef">
<meta property="og:title" content="YOLOv3-for-custum-objects">
<meta property="og:url" content="http://localhost:4000/projects/YOLOv3-for-custum-objects/">


  <meta property="og:description" content="Train YOLO obect detector on custom dataset">



  <meta property="og:image" content="http://localhost:4000/projects/YOLOv3-for-custum-objects/media/predictions.jpg">





  <meta property="article:published_time" content="2020-01-02T13:39:24+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/projects/YOLOv3-for-custum-objects/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Amine Hadj-Youcef",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Amine Hadj-Youcef Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/mon_logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Amine Hadj-Youcef
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/resume/" >Resume</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/" >Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/articles/" >Articles</a>
            </li><li class="masthead__menu-item">
              <a href="/papers/" >Papers</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
        <img src=
        
          "http://placehold.it/350x250"
        
        alt="logo">
      
      <h3>AI-Lab</h3>
      <p>Train YOLO obect detector on custom dataset</p>

      
    
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="YOLOv3-for-custum-objects">
    <meta itemprop="description" content="Train YOLO obect detector on custom dataset">
    <meta itemprop="datePublished" content="January 02, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">YOLOv3-for-custum-objects
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="training-a-fire-detector">Training a Fire Detector</h1>
<p>This folder illustrate the steps for training YOLOv3 and YOLOv3-tiny to detect fire in images and videos.</p>

<p>First a fire dataset of labeled images is collected from internet. The images with their annotations have been prepared and converted into YOLO format and put into one folder to gather all the data. Therefore, the data folder contains images (‘*jpg’) and their associated annotations files (‘.txt’) with the same name.</p>

<p>The annotations need to be converted into YOLO format, which is :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class_id, x_c/W, y_c/H, h/H, w/W&gt;
</code></pre></div></div>

<h2 id="install-ai-lab">Install <code class="language-plaintext highlighter-rouge">AI-lab</code></h2>

<p>First, launch the docker image <a href="https://github.com/amineHY/AI-LAB">AI-LAB</a> to start developing by pulling it from the Docker Hub registry</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull aminehy/ai-lab
</code></pre></div></div>

<p>Run this command to let docker transfer and access the display on the screen</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xhost +
</code></pre></div></div>

<p>Finally, run the AI-lab and start your development</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it --rm -v $(pwd):/workspace -w /workspace -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=$DISPLAY --runtime=nvidia -p 8888:8888 -p 6006:6006 aminehy/ai-lab
</code></pre></div></div>

<p>Done !</p>

<h2 id="retrain-yolo-on-a-costum-dataset">Retrain YOLO on a Costum Dataset</h2>

<p><img src="./media/retrain_Yolo.png" alt="retrain_Yolo diagram" /></p>

<h3 id="yolov3">YOLOv3</h3>

<ol>
  <li>
    <p>Create a customized configuration file for YOLO model from  <code class="language-plaintext highlighter-rouge">cfg/yolov3.cfg</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cp cfg/yolov3.cfg yolov3-obj.cfg
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yolov3-obj.cfg
     [net]
     # Testing
     # batch=64
     # subdivisions=8
     # Training
     batch=64
     subdivisions=16
     width=416
     height=416
     channels=3
     momentum=0.9
     decay=0.0005
     angle=0
     saturation = 1.5
     exposure = 1.5
     hue=.1
     ...
</code></pre></div>    </div>
  </li>
  <li>
    <p>Open <code class="language-plaintext highlighter-rouge">yolov3-obj.cfg</code> and edit its content with the appropriate information. In this application we have only one object to detect, ‘fire’, thus, <code class="language-plaintext highlighter-rouge">nb_class = 1</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> * batch = 64
 * subdivision=8 (increase if `Out of memory`)
 * filters = (nb_class+5)*3: filters = 255 =&gt; filter = 18
 * classes = nb_class: classes = 80  =&gt; classes = 1
 * max_batches=classes*2000: max_batches = 2000
 * steps=80% and 90% of max_batches : steps = 1600, 1800

</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a file <code class="language-plaintext highlighter-rouge">train.txt</code> that lists paths of all annotated images (*.jpg) of the dataset <code class="language-plaintext highlighter-rouge">data/obj/</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> train.txt
     data/obj/pic (132).jpg
     data/obj/img (42).jpg
     data/obj/img (90).jpg
     data/obj/pic (148).jpg
     data/obj/small (82).jpg
     data/obj/small (55).jpg
     data/obj/small (73).jpg
     data/obj/small (53).jpg
     data/obj/pic (42).jpg
     ...

</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <code class="language-plaintext highlighter-rouge">obj.names</code> and list the classes names</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> obj.names
     fire
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create and setup a data file <code class="language-plaintext highlighter-rouge">obj.data</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> obj.data
     classes = 1
     train  = train.txt
     valid  = train.txt
     names = obj.names
     backup = backup/
</code></pre></div>    </div>
  </li>
  <li>
    <p>Download pre-trained weights for the convolutional layers (154 MB): <a href="https://pjreddie.com/media/files/darknet53.conv.74">https://pjreddie.com/media/files/darknet53.conv.74</a></p>
  </li>
  <li>
    <p>Start training by using the command line</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./darknet detector train yolov3-obj.cfg obj.data darknet53.conv.74
</code></pre></div>    </div>
  </li>
  <li>
    <p>test:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./darknet detector test obj.data  yolov3-obj.cfg backup/yolov3-obj_final.weights
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="yolov3-tiny">YOLOv3-tiny</h3>

<ol>
  <li>
    <p>Create a customized configuration file for YOLO model from  <code class="language-plaintext highlighter-rouge">cfg/yolov3-tiny_obj.cfg</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cp cfg/yolov3.cfg yolov3-obj.cfg
</code></pre></div>    </div>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yolov3-obj.cfg
     [net]
     # Testing
     # batch=64
     # subdivisions=8
     # Training
     batch=64
     subdivisions=16
     width=416
     height=416
     channels=3
     momentum=0.9
     decay=0.0005
     angle=0
     saturation = 1.5
     exposure = 1.5
     hue=.1
     ...
</code></pre></div>    </div>
  </li>
  <li>
    <p>Open <code class="language-plaintext highlighter-rouge">yolov3-obj.cfg</code> and edit its content with the appropriate information. In this application we have only one object to detect, ‘fire’, thus, <code class="language-plaintext highlighter-rouge">nb_class = 1</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> * batch = 64
 * subdivision=8 (increase if `Out of memory`)
 * filters = (nb_class+5)*3: filters = 255 =&gt; filter = 18
 * classes = nb_class: classes = 80  =&gt; classes = 1
 * max_batches=classes*2000: max_batches = 2000
 * steps=80% and 90% of max_batches : steps = 1600, 1800

</code></pre></div>    </div>
  </li>
  <li>
    <p>Get pre-trained weights <code class="language-plaintext highlighter-rouge">yolov3-tiny.conv.15</code></p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./darknet partial cfg/yolov3-tiny.cfg fire/model/yolov3-tiny.weights fire/model/yolov3-tiny.conv.15 15
</code></pre></div></div>

<ol>
  <li>Training</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./darknet detector train obj.data yolov3-tiny-obj.cfg fire/model/yolov3-tiny.conv.15
</code></pre></div></div>

<ol>
  <li>Results</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v3 <span class="o">(</span>mse loss, Normalizer: <span class="o">(</span>iou: 0.750000, cls: 1.000000<span class="o">)</span> Region 23 Avg <span class="o">(</span>IOU: 0.664938, GIOU: 0.652729<span class="o">)</span>, Class: 0.999684, Obj: 0.376908, No Obj: 0.000314, .5R: 1.000000, .75R: 0.000000, count: 3

 2000: 0.604868, 0.560218 avg loss, 0.000010 rate, 1.346011 seconds, 128000 images
Saving weights to backup//yolov3-tiny-obj_2000.weights
Saving weights to backup//yolov3-tiny-obj_last.weights
Saving weights to backup//yolov3-tiny-obj_final.weights
</code></pre></div></div>

<p><img src="./media/chart_yolo-tiny.png" alt="chart_yolo-tiny" /></p>

<h2 id="test-of-the-trained-fire-detection-application">Test of the Trained Fire Detection Application</h2>
<p>(<strong>Note</strong>: You might want to recompile the DarkNet on your computer: Edit the <code class="language-plaintext highlighter-rouge">Makefile.txt</code> then run <code class="language-plaintext highlighter-rouge">make</code>)</p>

<h3 id="image">Image</h3>

<p>Detect fire in an imahge file</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
./darknet detector test fire/data/obj.data fire/cfg/yolov3-tiny-obj.cfg fire/model/yolov3-tiny-obj_final.weights fire/data/obj/img (9).jpg
```
</code></pre></div></div>

<p><img src="./media/predictions.jpg" alt="Results" /></p>

<h3 id="video">Video</h3>

<ul>
  <li>
    <p>Detect fire in real-time video stream from webcam</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./darknet detector demo fire/data/obj.data fire/cfg/yolov3-tiny-obj.cfg fire/model/yolov3-tiny-obj_final.weights
</code></pre></div>    </div>
    <p><strong>Note</strong>: add the option to save the output video: -out_filename filename.mp4</p>
  </li>
  <li>
    <p>Test on video stream from file</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./darknet detector demo fire/data/obj.data fire/cfg/yolov3-tiny-obj.cfg fire/model/yolov3-tiny-obj_final.weights fire/videos/test.mp4
</code></pre></div>    </div>
  </li>
  <li>
    <p>Example:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./darknet detector demo fire/data/obj.data fire/cfg/yolov3-tiny-obj.cfg fire/model/yolov3-tiny-obj_final.weights fire/videos/DJI_0070.MOV <span class="nt">-out_filename</span> ./fire/videos/DJI_0070_output.mp4
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="pre-trained-models">Pre-trained Models</h1>

<p>There are weights-file for different cfg-files (smaller size -&gt; faster speed &amp; lower accuracy:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">yolov3-openimages.cfg</code> (247 MB COCO Yolo v3) - requires 4 GB GPU-RAM: https://pjreddie.com/media/files/yolov3-openimages.weights</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">yolov3-spp.cfg</code> (240 MB COCO Yolo v3) - requires 4 GB GPU-RAM: https://pjreddie.com/media/files/yolov3-spp.weights</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">yolov3.cfg</code> (236 MB COCO Yolo v3) - requires 4 GB GPU-RAM: https://pjreddie.com/media/files/yolov3.weights</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">yolov3-tiny.cfg</code> (34 MB COCO Yolo v3 tiny) - requires 1 GB GPU-RAM: https://pjreddie.com/media/files/yolov3-tiny.weights</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enet-coco.cfg</code> (EfficientNetb0-Yolo- 45.5% mAP@0.5 - 3.7 BFlops)</p>
  </li>
</ul>

<p><a href="https://drive.google.com/file/d/1FlHeQjWEQVJt0ay1PVsiuuMzmtNyv36m/view"><code class="language-plaintext highlighter-rouge">enetb0-coco_final.weights</code></a> and <code class="language-plaintext highlighter-rouge">yolov3-tiny-prn.cfg</code> (33.1% mAP@0.5 - 3.5 BFlops - more)</p>

<h1 id="reference">Reference</h1>

<ul>
  <li>https://github.com/AlexeyAB/darknet</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-01-02T13:39:24+01:00">January 02, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
  <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=YOLOv3-for-custum-objects%20http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FYOLOv3-for-custum-objects%2F"
    class="btn btn--twitter"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on Twitter"><i
      class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FYOLOv3-for-custum-objects%2F"
    class="btn btn--facebook"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on Facebook"><i
      class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FYOLOv3-for-custum-objects%2F"
    class="btn btn--linkedin"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on LinkedIn"><i
      class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      
  <nav class="pagination">
    
      <a href="/projects/AI-lab/" class="pagination--pager" title="AI-lab
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <center>
  <div class="page__footer-follow">
    <ul class="social-icons">

      
        
          

            <li>
              <a href="https://www.linkedin.com/in/aminehy/" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i>
                LinkedIn
              </a>
            </li>
          
        
          

            <li>
              <a href="https://medium.com/@Amine_hy" rel="nofollow noopener noreferrer"><i class="fab fa-medium" aria-hidden="true"></i>
                Medium
              </a>
            </li>
          
        
          

            <li>
              <a href="https://github.com/aminehy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i>
                GitHub
              </a>
            </li>
          
        
          

            <li>
              <a href="https://gitlab.com/aminehy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i>
                GitLab
              </a>
            </li>
          
        
          

            <li>
              <a href="https://www.researchgate.net/profile/M_Amine_Hadj-Youcef" rel="nofollow noopener noreferrer"><i class="fab fa-researchgate" aria-hidden="true"></i>
                ResearshGate
              </a>
            </li>
          
        
      

      <!-- <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> feed</a></li> -->
    </ul>
 </div>

 <div class="page__footer-copyright">&copy; 2020 Amine Hadj-Youcef </div>
</center>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
