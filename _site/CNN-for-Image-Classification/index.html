<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Convolutional Neural Network for image classification - Amine Hadj-Youcef</title>
<meta name="description" content="image classification with deep learning">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Amine Hadj-Youcef">
<meta property="og:title" content="Convolutional Neural Network for image classification">
<meta property="og:url" content="http://localhost:4000/CNN-for-Image-Classification/">


  <meta property="og:description" content="image classification with deep learning">



  <meta property="og:image" content="http://localhost:4000/assets/images/CNN-image-classification.png">





  <meta property="article:published_time" content="2019-04-19T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/CNN-for-Image-Classification/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Amine Hadj-Youcef",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Amine Hadj-Youcef Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/mon_logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Amine Hadj-Youcef
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/resume/" >Resume</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/" >Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/articles/" >Articles</a>
            </li><li class="masthead__menu-item">
              <a href="/papers/" >Papers</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/CNN-image-classification.png" alt="Convolutional Neural Network for image classification" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Convolutional Neural Network for image classification">
    <meta itemprop="description" content="image classification with deep learning">
    <meta itemprop="datePublished" content="April 19, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Convolutional Neural Network for image classification
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="a-dive-into-an-artificial-intelligence-algorithm">A Dive into an Artificial Intelligence algorithm</h1>

<p>This article will explain the Convolutional Neural Network (CNN) with an illustration of image classification. It provides a simple implementation of the CNN algorithm using the framework PyTorch on Python. There are many free courses that can be found on the internet. Personally, I suggest the course of <em>Andrej Karpathy</em> at Stanford university (<a href="http://twitter.com/karpathy">@karpathy</a>). You will learn a lot, it is a step by step course. In addition, it provides many practical strategies to implement the CNN architecture.</p>

<p>Link to the course: <a href="http://cs231n.github.io/convolutional-networks/">CS231n Convolutional Neural Networks for Visual Recognition</a></p>

<h1 id="what-is-a-convolutional-neural-network">What is a Convolutional Neural Network?</h1>

<p>Before going deep into Convolutional Neural Network, it is worth understanding their concept. CNN falls in the category of the supervised algorithms. The algorithm learns from training data, e,g, a set of images in the input and theirs associated labels at the output.</p>

<p>It consists of feeding the convolutional neural network with images of the training set, x, and their associated labels (targets), y, in order to learn network’s function, y=f(x). After learning the parameter of the network’s function (namely weight and bias), we test the network with an unseen images in order to predict their labels.The architecture of a Convolutional Neural Network (CNN or ConvNet)</p>

<p>The CNN architecture we used in this article is proposed in <a href="http://personal.ie.cuhk.edu.hk/~ccloy/project_target_code/index.html">this paper</a>.</p>

<p>Here is an illustration of the image classification using CNN architecture</p>

<p align="center">
  <img src="https://cdn-images-1.medium.com/max/6096/1*JAoTFAsN5HCrRgrJPaBgrg.png" alt="pooling" />
</p>

<h1 id="implementation-of-the-cnn-in-python-using-the-pytorch-library">Implementation of the CNN in Python using the PyTorch library</h1>

<p>The network is implemented as a class called CNN. It contains two main methods. The first method (<strong>init</strong>) defines layers components of the network. In the second method (<em>forward</em>) we wire the network and put every component in the desired order (as shown in the picture).</p>

<p>The python code bellow is straightforward. The network is defined using the neural network module of Torch. Notice that we already choose hyper-parameters of the network, such as Padding (P), Stride (S) and Kernel_size (F). Also the number of filters at each layer, … .</p>

<p>The input image has four dimensions, (batch_size, num_channel, height, width). The algorithm outputs an array with ten values, corresponding to the score (or amount of energy) of the predicted labels of the image. Therefore, the maximum score is the predicted label (or class) to retain for the tested image.</p>

<p>In the following bullet we will explain the role of each layer of the algorithm:</p>

<ul>
  <li><em>Conv layer</em>: This is the main layer of the algorithm. It consists of extracting the key features in the input image (sharp edge, smoothness, rounded shape, …). This is done through a set of 2-dimensional convolutions of the image inthe input with one or many filters. Note that the convolution is performed simultaneously for each channel of the input image, e.g. a color image has C=3 channels, RGB: Red, Green, and Blue. The filters are set to have odd size for practical purpose CxFxF, e.g, 3x3x3, 3x5x5. The output of this operation is one scalar value, an artificial neuron. An illustrative animation for the convolution layer is given in <a href="http://cs231n.github.io/convolutional-networks/#conv">http://cs231n.github.io/convolutional-networks/#conv</a>.</li>
</ul>

<p><img src="https://cdn-images-1.medium.com/max/2000/1*qtinjiZct2w7Dr4XoFixnA.gif" alt="Source: [http://cs231n.github.io/convolutional-networks/#conv](http://cs231n.github.io/convolutional-networks/#conv)" /></p>

<p><em>Source: <a href="http://cs231n.github.io/convolutional-networks/#conv">http://cs231n.github.io/convolutional-networks/#conv</a></em></p>

<p>Furthermore, the Conv layer is applied repeatedly to extract fine features that characterize the input image. The outputs of the Conv layer are called features map (or activation map), where each spatial position (or pixel) represents an artificial neuron.</p>

<ul>
  <li><em>ReLU (Rectifier Linear Units)</em>: It performs hard thresholding for negative values to zero, and leave positive values untouched, i,e, ReLU(x)=max(0, x). This layer preserves the dynamic range of the feature map.</li>
</ul>

<p align="center">
  <img src="https://cdn-images-1.medium.com/max/2000/1*njuH4XVXf-l9pR_RorUOrA.png" alt="pooling" />
</p>
<ul>
  <li><em>Maxpooling layer</em>: It performs spatial down-sampling of the feature map and retains only the most relevant information. See the picture below for a visual illustration of this operation. From a practical point of view, a pooling of size 2x2 with a stride of 2 gives good results on most applications. Having said that, other types of pooling exist, e,g, average pooling, median pooling, sum pooling, …</li>
</ul>

<p align="center">
  <img src="https://cdn-images-1.medium.com/max/2000/1*gaD6SJ6kQNVOclE_WkwLNQ.png" alt="pooling" />
</p>

<h1 id="how-about-the-python-implementation-of-cnn">How about the Python implementation of CNN?</h1>

<p>For this article, I used the neural network framework PyTorch to implement the CNN architecture detailed above.</p>

<p>The full code is available in my GitHub repository: <a href="https://github.com/amineHY/Image-classification-of-MNIST/blob/master/pytorch_mnist_deep_cnn.ipynb">amineHY/Image-classification-of-MNIST</a>
This repository contains notebooks for image classification of the MNIST dataset. The code is quite simple to understand, hopefully, since it mentions all the layers we discussed earlier in an intuitive way.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Implementation of CNN/ConvNet Model using PyTorch (depicted in the picture above)</span>

<span class="k">class</span> <span class="nc">CNN</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="c"># L1 ImgIn shape=(?, 28, 28, 1)</span>
        <span class="c">#    Conv     -&gt; (?, 28, 28, 32)</span>
        <span class="c">#    Pool     -&gt; (?, 14, 14, 32)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_prob</span><span class="p">))</span>
        <span class="c"># L2 ImgIn shape=(?, 14, 14, 32)</span>
        <span class="c">#    Conv      -&gt;(?, 14, 14, 64)</span>
        <span class="c">#    Pool      -&gt;(?, 7, 7, 64)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_prob</span><span class="p">))</span>
        <span class="c"># L3 ImgIn shape=(?, 7, 7, 64)</span>
        <span class="c">#    Conv      -&gt;(?, 7, 7, 128)</span>
        <span class="c">#    Pool      -&gt;(?, 4, 4, 128)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_prob</span><span class="p">))</span>

        <span class="c"># L4 FC 4x4x128 inputs -&gt; 625 outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer4</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_prob</span><span class="p">))</span>
        <span class="c"># L5 Final FC 625 inputs -&gt; 10 outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">625</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> <span class="c"># initialize parameters</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c"># Flatten them for FC</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>


<span class="c"># instantiate CNN model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CNN</span><span class="p">()</span>
<span class="n">model</span>
</code></pre></div></div>

<p>Note that all the number mentioned in the input of the methods is parameters. They define the CNN architecture: kernel_size, stride, padding, input/output of each Conv layer. The code below defines a class called CNN where we define the CNN architecture in order.</p>

<p>The output of the above code summarizes the network architecture:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  CNN<span class="o">(</span>
    <span class="o">(</span>layer1<span class="o">)</span>: Sequential<span class="o">(</span>
      <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>1, 32, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">))</span>
      <span class="o">(</span>1<span class="o">)</span>: ReLU<span class="o">()</span>
      <span class="o">(</span>2<span class="o">)</span>: MaxPool2d<span class="o">(</span><span class="nv">kernel_size</span><span class="o">=</span>2, <span class="nv">stride</span><span class="o">=</span>2, <span class="nv">padding</span><span class="o">=</span>0, <span class="nv">dilation</span><span class="o">=</span>1, <span class="nv">ceil_mode</span><span class="o">=</span>False<span class="o">)</span>
      <span class="o">(</span>3<span class="o">)</span>: Dropout<span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.30<span class="o">)</span>
    <span class="o">)</span>
    <span class="o">(</span>layer2<span class="o">)</span>: Sequential<span class="o">(</span>
      <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>32, 64, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">))</span>
      <span class="o">(</span>1<span class="o">)</span>: ReLU<span class="o">()</span>
      <span class="o">(</span>2<span class="o">)</span>: MaxPool2d<span class="o">(</span><span class="nv">kernel_size</span><span class="o">=</span>2, <span class="nv">stride</span><span class="o">=</span>2, <span class="nv">padding</span><span class="o">=</span>0, <span class="nv">dilation</span><span class="o">=</span>1, <span class="nv">ceil_mode</span><span class="o">=</span>False<span class="o">)</span>
      <span class="o">(</span>3<span class="o">)</span>: Dropout<span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.30<span class="o">)</span>
    <span class="o">)</span>
    <span class="o">(</span>layer3<span class="o">)</span>: Sequential<span class="o">(</span>
      <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>64, 128, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">))</span>
      <span class="o">(</span>1<span class="o">)</span>: ReLU<span class="o">()</span>
      <span class="o">(</span>2<span class="o">)</span>: MaxPool2d<span class="o">(</span><span class="nv">kernel_size</span><span class="o">=</span>2, <span class="nv">stride</span><span class="o">=</span>2, <span class="nv">padding</span><span class="o">=</span>1, <span class="nv">dilation</span><span class="o">=</span>1, <span class="nv">ceil_mode</span><span class="o">=</span>False<span class="o">)</span>
      <span class="o">(</span>3<span class="o">)</span>: Dropout<span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.30<span class="o">)</span>
    <span class="o">)</span>
    <span class="o">(</span>fc1<span class="o">)</span>: Linear<span class="o">(</span><span class="nv">in_features</span><span class="o">=</span>2048, <span class="nv">out_features</span><span class="o">=</span>625, <span class="nv">bias</span><span class="o">=</span>True<span class="o">)</span>
    <span class="o">(</span>layer4<span class="o">)</span>: Sequential<span class="o">(</span>
      <span class="o">(</span>0<span class="o">)</span>: Linear<span class="o">(</span><span class="nv">in_features</span><span class="o">=</span>2048, <span class="nv">out_features</span><span class="o">=</span>625, <span class="nv">bias</span><span class="o">=</span>True<span class="o">)</span>
      <span class="o">(</span>1<span class="o">)</span>: ReLU<span class="o">()</span>
      <span class="o">(</span>2<span class="o">)</span>: Dropout<span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.30<span class="o">)</span>
    <span class="o">)</span>
    <span class="o">(</span>fc2<span class="o">)</span>: Linear<span class="o">(</span><span class="nv">in_features</span><span class="o">=</span>625, <span class="nv">out_features</span><span class="o">=</span>10, <span class="nv">bias</span><span class="o">=</span>True<span class="o">)</span>
  <span class="o">)</span>
</code></pre></div></div>

<h1 id="importing-mnist-dataset">Importing MNIST Dataset</h1>

<p>In order to acquire the MNIST images, we use a method of torchvision library. Just copy paste this code to download the data. Basically, two datasets are loaded. The training dataset serves as ground truth to compute the network parameters. The testing images</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">torch</span>
  <span class="kn">import</span> <span class="nn">torchvision.datasets</span> <span class="k">as</span> <span class="n">dsets</span>


  <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>

  <span class="c"># MNIST dataset</span>
  <span class="n">mnist_train</span> <span class="o">=</span> <span class="n">dsets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s">'MNIST_data/'</span><span class="p">,</span>
                            <span class="n">train</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                            <span class="n">download</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="n">mnist_test</span> <span class="o">=</span> <span class="n">dsets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s">'MNIST_data/'</span><span class="p">,</span>
                           <span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                           <span class="n">download</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="c"># dataset loader</span>
  <span class="n">data_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mnist_train</span><span class="p">,</span>
                                            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                                            <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="training-the-classification-model">Training the classification model</h1>

<p>This is an essential stage of a supervised algorithm. By feeding the algorithm with many examples of image and their associated labels, we teach the algorithm to find patterns of each class. This is done by computing filter’s parameters (weight and bias).</p>

<p>The training of the network is composed of two major steps, forward and backward:</p>

<ul>
  <li>
    <p>During the forward pass, we feed the network by images of the training set and compute the features map till the end of the network, then we compute the loss function to measure how far / close the solution (predicted label) is from the ground truth label.</p>
  </li>
  <li>
    <p>The backward pass performs the computation of the loss function’s gradient and updates the filters’ parameters.</p>
  </li>
</ul>

<p>We also need to define an loss function, e.g. <a href="https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_error_function_and_logistic_regression">Cross-entropy loss function</a>, and an optimization algorithm, such as <a href="https://arxiv.org/pdf/1412.6980.pdf">Gradient descent, SGD, Adam</a> (Adaptive moment estimation<a href="https://arxiv.org/pdf/1412.6980.pdf">)</a>…</p>

<p><img src="https://cdn-images-1.medium.com/max/2000/1*MOVbwX27vXjzYmfV1NSswQ.png" alt="[Source: https://arxiv.org/pdf/1412.6980.pdf](https://arxiv.org/pdf/1412.6980.pdf)" /><em><a href="https://arxiv.org/pdf/1412.6980.pdf">Source: https://arxiv.org/pdf/1412.6980.pdf</a></em></p>

<p><strong>What to remember</strong> for training a deep learning algorithm:</p>

<p>— Initialize the parameters (weights : w, bias: b)
 — Optimize the loss iteratively to learn parameters (w,b)
 — Compute the loss function and its gradients
 — Update parameters using an optimization algorithm (e,g, Adam)
 — Use the learned parameters to predict the label for a given input image</p>

<h3 id="python-implementation-of-training-cnn-in-python-using-pytorch">Python implementation of training CNN in Python using PyTorch</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'Training the Deep Learning network ...'</span><span class="p">)</span>

<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>    <span class="c"># Softmax is internally computed.</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

<span class="n">train_cost</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">train_accu</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">training_epochs</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">total_batch</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mnist_train</span><span class="p">)</span> <span class="o">//</span> <span class="n">batch_size</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Size of the training dataset is {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mnist_train</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Size of the testing dataset'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mnist_test</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Batch size is : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_size</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Total number of batches is : {0:2.0f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_batch</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">Total number of epochs is : {0:2.0f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">training_epochs</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">compute_accuracy</span><span class="p">(</span><span class="n">Y_target</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">):</span>
    <span class="n">Y_prediction</span> <span class="o">=</span> <span class="n">hypothesis</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="p">((</span><span class="n">Y_prediction</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">Y_target</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="nb">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>    
    <span class="k">return</span> <span class="n">accuracy</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>


<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_epochs</span><span class="p">):</span>
    <span class="n">avg_cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">batch_X</span><span class="p">,</span> <span class="n">batch_Y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>

        <span class="c"># Select a minibatch</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">batch_X</span><span class="p">)</span>    <span class="c"># image is already size of (28x28), no reshape</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">batch_Y</span><span class="p">)</span>    <span class="c"># label is not one-hot encoded</span>

        <span class="c"># initialization of the gradients</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c"># Forward propagation: compute the output</span>
        <span class="n">hypothesis</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c"># Computation of the cost J</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="c"># &lt;= compute the loss function</span>

        <span class="c"># Backward propagation</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="c"># &lt;= compute the gradients</span>

        <span class="c"># Update parameters (weights and biais)</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c"># Print some performance to monitor the training</span>
        <span class="n">train_accu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compute_accuracy</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">))</span>
        <span class="n">train_cost</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>   
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">200</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Epoch= {},</span><span class="se">\t</span><span class="s"> batch = {},</span><span class="se">\t</span><span class="s"> cost = {:2.4f},</span><span class="se">\t</span><span class="s"> accuracy = {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">train_cost</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">train_accu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">avg_cost</span> <span class="o">+=</span> <span class="n">cost</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">total_batch</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"[Epoch: {:&gt;4}], averaged cost = {:&gt;.9}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">avg_cost</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>


<span class="k">print</span><span class="p">(</span><span class="s">'Learning Finished!'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="monitoring-the-training-by-plotting-the-loss-function-and-the-accuracy">Monitoring the training by plotting the Loss-Function and the Accuracy</h2>

<p align="center">
  <img src="https://cdn-images-1.medium.com/max/2000/1*us1x6tgDfYBRhme0j3dgFg.png" alt="pooling" />
</p>

<p>Plotting these plots help monitor understanding the convergence of the algorithm. The loss plot is decreasing during the training which a what we want since the goal of the optimization algorithm (Adam) is to minimize the loss function. On the right, the plot shows the evolution of the classification accuracy during the training. The more we train the algorithm, the better the classification accuracy. Notice the fluctuation of the accuracy between ~90 and 100 %. Better tuning of hyper-parameters will provide a precise classification.</p>

<h2 id="display-of-classification-results">Display of Classification Results</h2>

<p>The classification algorithm is able to understand the content of these images thanks to the training of CNN.</p>

<p align="center">
  <img src="https://cdn-images-1.medium.com/max/2000/1*bgm3yCrLs1wvE9UskdBhRA.png" alt="pooling" />
</p>

<h1 id="conclusion">Conclusion</h1>

<p>This article attempts to explain briefly the convolutional neural network without going deep into mathematical development. An illustration is provided at each step with a visual explanation, as well as an application of image classification of MNIST dataset. Finally, a python implementation using PyTorch library is presented in order to provide a concrete example of application. Hopefully, you will find it interesting and easy to read.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#computer-vision" class="page__taxonomy-item" rel="tag">Computer Vision</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#image-classification" class="page__taxonomy-item" rel="tag">Image classification</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-19T00:00:00+02:00">April 19, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
  <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Convolutional+Neural+Network+for+image+classification%20http%3A%2F%2Flocalhost%3A4000%2FCNN-for-Image-Classification%2F"
    class="btn btn--twitter"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on Twitter"><i
      class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FCNN-for-Image-Classification%2F"
    class="btn btn--facebook"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on Facebook"><i
      class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FCNN-for-Image-Classification%2F"
    class="btn btn--linkedin"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on LinkedIn"><i
      class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/Optimize/" class="pagination--pager" title="Have you Optimized your Deep Learning Model Before Deployment?
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/nature_1.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/pensarsdk-1/" rel="permalink">Pensar SDK, A Rapid Artificial Intelligence Application Development framework
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">A Software Development Kit (SDK) for rapid development of artificial intelligence based Computer Vision  application
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/nature_1.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Optimize/" rel="permalink">Have you Optimized your Deep Learning Model Before Deployment?
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Optimization of deep learning model
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <center>
  <div class="page__footer-follow">
    <ul class="social-icons">

      
        
          

            <li>
              <a href="https://www.linkedin.com/in/aminehy/" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i>
                LinkedIn
              </a>
            </li>
          
        
          

            <li>
              <a href="https://medium.com/@Amine_hy" rel="nofollow noopener noreferrer"><i class="fab fa-medium" aria-hidden="true"></i>
                Medium
              </a>
            </li>
          
        
          

            <li>
              <a href="https://github.com/aminehy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i>
                GitHub
              </a>
            </li>
          
        
          

            <li>
              <a href="https://gitlab.com/aminehy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i>
                GitLab
              </a>
            </li>
          
        
          

            <li>
              <a href="https://www.researchgate.net/profile/M_Amine_Hadj-Youcef" rel="nofollow noopener noreferrer"><i class="fab fa-researchgate" aria-hidden="true"></i>
                ResearshGate
              </a>
            </li>
          
        
      

      <!-- <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> feed</a></li> -->
    </ul>
 </div>

 <div class="page__footer-copyright">&copy; 2020 Amine Hadj-Youcef </div>
</center>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
